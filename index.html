<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kasir Warung - Sistem POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Link external stylesheet for custom styles -->
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            box-sizing: border-box;
        }
        
        /* Mobile optimizations */
        @media (max-width: 640px) {
            .container {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            body {
                font-size: 14px;
            }
            
            h1 {
                font-size: 1.25rem !important;
            }
            
            .mobile-compact {
                padding: 0.5rem !important;
            }
            
            button, input, select {
                min-height: 40px;
                font-size: 14px;
            }
            
            input[type="text"], input[type="number"] {
                font-size: 16px;
            }
            
            #floatingCart {
                width: calc(100vw - 1rem) !important;
                max-width: 320px !important;
                bottom: 0.5rem !important;
                right: 0.5rem !important;
            }
        }
        
        .scanner-line {
            animation: scan 2s linear infinite;
        }
        @keyframes scan {
            0%, 100% { transform: translateY(-100%); }
            50% { transform: translateY(100%); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.5s ease-out;
        }
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .pulse-success {
            animation: pulseSuccess 0.6s ease-out;
        }
        @keyframes pulseSuccess {
            0% { transform: scale(1); background-color: rgb(34 197 94); }
            50% { transform: scale(1.05); background-color: rgb(22 163 74); }
            100% { transform: scale(1); background-color: rgb(34 197 94); }
        }
        
        .hover-lift {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .active-press {
            transition: transform 0.1s ease;
        }
        .active-press:active {
            transform: scale(0.95);
        }

        .stock-critical {
            background: linear-gradient(45deg, #fee2e2, #fecaca);
            border-color: #f87171;
        }
        
        .stock-low {
            background: linear-gradient(45deg, #fef3c7, #fde68a);
            border-color: #f59e0b;
        }
        
        .stock-ok {
            background: linear-gradient(45deg, #dcfce7, #bbf7d0);
            border-color: #22c55e;
        }

        .printer-status {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 1000;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .printer-connected {
            background-color: #10b981;
            color: white;
        }
        
        .printer-disconnected {
            background-color: #ef4444;
            color: white;
        }

        /* Loading spinner styles */
        /* A simple spinner displayed in the loading overlay. The border-top color
           can be changed to match the application's theme. */
        .loader {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #3490dc;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- Printer Status -->
    <div id="printerStatus" class="printer-status printer-disconnected hidden">
        üñ®Ô∏è Printer Terputus
    </div>

    <!-- Header -->
    <header class="bg-white shadow-lg border-b-4 border-green-500">
        <div class="container mx-auto px-2 sm:px-4 py-2 sm:py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-1 sm:space-x-3">
                    <div class="bg-gradient-to-br from-green-500 to-green-600 text-white p-1 sm:p-2 rounded-lg shadow-lg">
                        <svg class="w-4 h-4 sm:w-6 sm:h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 2L2 7V10C2 16 6 20.9 12 22C18 20.9 22 16 22 10V7L12 2ZM12 4.3L20 8.2V10C20 15.5 16.64 19.88 12 20.9C7.36 19.88 4 15.5 4 10V8.2L12 4.3ZM10.5 12.5L8.5 10.5L7 12L10.5 15.5L17 9L15.5 7.5L10.5 12.5Z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-base sm:text-2xl font-bold text-gray-800">TOKO BAROKAH</h1>
                        <p class="text-xs sm:text-sm text-gray-600">RT 02 Desa Pematang Gadung</p>
                    </div>
                </div>
                <div class="flex items-center space-x-1 sm:space-x-4">
                    <div class="text-right hidden md:block">
                        <div class="text-xs sm:text-sm text-gray-600">Kasir: Admin</div>
                        <div class="text-xs sm:text-sm font-semibold text-green-600" id="currentTime"></div>
                    </div>
                    <button onclick="connectThermalPrinter()" class="bg-purple-500 hover:bg-purple-600 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-lg font-semibold transition-colors text-xs sm:text-base hover-lift active-press">
                        üñ®Ô∏è <span class="hidden sm:inline">Printer</span>
                    </button>
                    <button onclick="showReports()" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-lg font-semibold transition-colors text-xs sm:text-base hover-lift active-press">
                        üìä <span class="hidden sm:inline">Laporan</span>
                    </button>
                    <!-- Buttons to export/import data to Google Sheets -->
                    <button onclick="exportDataToGoogleSheets()" class="bg-blue-500 hover:bg-blue-600 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-lg font-semibold transition-colors text-xs sm:text-base hover-lift active-press">
                        ‚¨ÜÔ∏è <span class="hidden sm:inline">Export</span>
                    </button>
                    <button onclick="importDataFromGoogleSheets()" class="bg-orange-500 hover:bg-orange-600 text-white px-2 py-1 sm:px-4 sm:py-2 rounded-lg font-semibold transition-colors text-xs sm:text-base hover-lift active-press">
                        ‚¨áÔ∏è <span class="hidden sm:inline">Import</span>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-2 sm:px-4 py-3 sm:py-6">
        <!-- Navigation Tabs -->
        <div class="bg-white rounded-lg sm:rounded-xl shadow-lg mb-3 sm:mb-6">
            <div class="flex border-b border-gray-200 overflow-x-auto">
                <button onclick="switchTab('scanner')" id="scannerTab" class="flex-1 py-2 px-2 sm:py-4 sm:px-6 text-center font-semibold transition-colors bg-green-500 text-white rounded-tl-lg sm:rounded-tl-xl whitespace-nowrap text-xs sm:text-base">
                    üì± <span class="hidden sm:inline">Scanner</span>
                </button>
                <button onclick="switchTab('products')" id="productsTab" class="flex-1 py-2 px-2 sm:py-4 sm:px-6 text-center font-semibold transition-colors text-gray-600 hover:text-green-600 hover:bg-green-50 whitespace-nowrap text-xs sm:text-base">
                    üì¶ <span class="hidden sm:inline">Produk</span>
                </button>
                <button onclick="switchTab('history')" id="historyTab" class="flex-1 py-2 px-2 sm:py-4 sm:px-6 text-center font-semibold transition-colors text-gray-600 hover:text-green-600 hover:bg-green-50 whitespace-nowrap text-xs sm:text-base">
                    üìú <span class="hidden sm:inline">Riwayat</span>
                </button>
                <button onclick="switchTab('analysis')" id="analysisTab" class="flex-1 py-2 px-2 sm:py-4 sm:px-6 text-center font-semibold transition-colors text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-tr-lg sm:rounded-tr-xl whitespace-nowrap text-xs sm:text-base">
                    üìä <span class="hidden sm:inline">Analisa</span>
                </button>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="space-y-6">
            <!-- Scanner Tab -->
            <div id="scannerContent" class="tab-content">
                <div class="bg-white rounded-lg sm:rounded-xl shadow-lg p-3 sm:p-6">
                    <h2 class="text-lg sm:text-xl font-bold text-gray-800 mb-3 sm:mb-4 flex items-center">
                        <span class="bg-green-100 text-green-600 p-1.5 sm:p-2 rounded-lg mr-2 sm:mr-3">üì±</span>
                        <span class="text-sm sm:text-lg">Scanner Barcode</span>
                    </h2>
                    <div class="relative">
                        <div class="bg-gray-100 border-2 border-dashed border-gray-300 rounded-lg p-4 sm:p-8 text-center relative overflow-hidden">
                            <div class="scanner-line absolute top-0 left-0 right-0 h-0.5 bg-red-500"></div>
                            <svg class="w-12 h-12 sm:w-16 sm:h-16 mx-auto text-gray-400 mb-2 sm:mb-4" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h3a1 1 0 000 2H5v1a1 1 0 01-2 0V4zm0 10v-1a1 1 0 112 0v1h1a1 1 0 110 2H4a1 1 0 01-1-1zm10 1a1 1 0 01-1-1v-1a1 1 0 112 0v1h1a1 1 0 110 2h-3zm2-10V4a1 1 0 00-1-1h-3a1 1 0 100 2h1v1a1 1 0 102 0z" clip-rule="evenodd"/>
                            </svg>
                            <p class="text-gray-600 font-semibold text-sm sm:text-base">Arahkan barcode ke kamera</p>
                            <p class="text-xs sm:text-sm text-gray-500 mt-1 sm:mt-2">atau ketik barcode manual di bawah</p>
                        </div>
                        <input type="text" id="barcodeInput" placeholder="Ketik atau scan barcode..." 
                               class="w-full mt-3 sm:mt-4 px-3 sm:px-4 py-2 sm:py-3 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none text-base sm:text-lg"
                               onkeypress="handleBarcodeInput(event)" oninput="showProductSuggestions(this.value)">
                        
                        <!-- Product Suggestions -->
                        <div id="productSuggestions" class="hidden mt-2 bg-white border-2 border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                        </div>
                    </div>

                    <!-- Product Table -->
                    <div class="mt-6 bg-gray-50 rounded-lg p-4">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                            <span class="bg-blue-100 text-blue-600 p-1.5 rounded-lg mr-2">üìã</span>
                            Daftar Produk
                        </h3>
                        
                        <!-- Search for table -->
                        <div class="mb-4 relative">
                            <input type="text" id="scannerProductSearch" placeholder="Cari produk dalam tabel..." 
                                   class="w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm"
                                   oninput="searchScannerProducts(this.value)" onkeypress="handleScannerTableSearch(event)">
                            <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üîç</div>
                        </div>

                        <!-- Product Table -->
                        <div class="overflow-x-auto bg-white rounded-lg shadow-sm">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-3 py-2 text-left font-semibold text-gray-700">Nama Produk</th>
                                        <th class="px-3 py-2 text-left font-semibold text-gray-700">Barcode</th>
                                        <th class="px-3 py-2 text-right font-semibold text-gray-700">Harga</th>
                                        <th class="px-3 py-2 text-center font-semibold text-gray-700">Stok</th>
                                        <th class="px-3 py-2 text-center font-semibold text-gray-700">Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="scannerProductTable">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Products Tab -->
            <div id="productsContent" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 space-y-3 sm:space-y-0">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                            <span class="bg-purple-100 text-purple-600 p-2 rounded-lg mr-3">üì¶</span>
                            Produk Tersimpan
                        </h2>
                    </div>

                    <!-- Search Bar -->
                    <div class="mb-4 relative">
                        <input type="text" id="productSearchInput" placeholder="Cari produk..." 
                               class="w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:border-purple-500 focus:outline-none"
                               oninput="searchProducts(this.value)">
                        <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üîç</div>
                    </div>

                    <!-- View Mode Toggle Buttons -->
                    <div class="mb-4 flex space-x-2">
                        <button id="viewGridButton" onclick="setProductViewMode('grid')" 
                                class="px-3 py-1 rounded-lg text-sm font-semibold active-press bg-green-500 text-white hover:bg-green-600">
                            Grid
                        </button>
                        <button id="viewTableButton" onclick="setProductViewMode('table')" 
                                class="px-3 py-1 rounded-lg text-sm font-semibold active-press bg-gray-200 text-gray-700 hover:bg-gray-300">
                            Tabel
                        </button>
                        <button id="viewListButton" onclick="setProductViewMode('list')" 
                                class="px-3 py-1 rounded-lg text-sm font-semibold active-press bg-gray-200 text-gray-700 hover:bg-gray-300">
                            List
                        </button>
                    </div>

                    <!-- Products Container -->
                    <div id="savedProducts" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
                    </div>
                    
                    <button onclick="showAddProductModal()" 
                            class="mt-4 w-full bg-purple-500 hover:bg-purple-600 text-white py-2 px-4 rounded-lg font-semibold transition-colors">
                        ‚ûï Tambah Produk Baru
                    </button>
                </div>
            </div>

            <!-- History Tab -->
            <div id="historyContent" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 space-y-3 sm:space-y-0">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center">
                            <span class="bg-indigo-100 text-indigo-600 p-2 rounded-lg mr-3">üìú</span>
                            Riwayat Transaksi
                        </h2>
                        
                        <!-- Filter Options -->
                        <div class="flex items-center space-x-2">
                            <select id="historyFilter" onchange="filterTransactionHistory()" 
                                    class="px-3 py-1 border border-gray-300 rounded-lg text-sm focus:border-indigo-500 focus:outline-none">
                                <option value="all">Semua</option>
                                <option value="today">Hari Ini</option>
                                <option value="week">Minggu Ini</option>
                                <option value="month">Bulan Ini</option>
                                <option value="full">Lunas</option>
                                <option value="partial">Hutang</option>
                            </select>
                        </div>
                    </div>

                    <!-- Search Bar -->
                    <div class="mb-4 relative">
                        <input type="text" id="historySearchInput" placeholder="Cari transaksi..." 
                               class="w-full pl-10 pr-4 py-2 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:outline-none"
                               oninput="searchTransactionHistory(this.value)">
                        <div class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üîç</div>
                    </div>

                    <!-- Transaction History -->
                    <div id="transactionHistory" class="space-y-3 max-h-96 overflow-y-auto">
                    </div>
                </div>
            </div>

            <!-- Analysis Tab -->
            <div id="analysisContent" class="tab-content hidden">
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <span class="bg-indigo-100 text-indigo-600 p-2 rounded-lg mr-3">üìä</span>
                        Analisa Laba Rugi
                    </h2>
                    
                    <!-- Summary Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h4 class="font-bold text-green-800 mb-2">üí∞ Total Penjualan</h4>
                            <div class="text-xl font-bold text-green-600" id="totalRevenue">Rp 0</div>
                            <div class="text-sm text-gray-600" id="revenueCount">0 transaksi</div>
                        </div>
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h4 class="font-bold text-red-800 mb-2">üì¶ Total Modal</h4>
                            <div class="text-xl font-bold text-red-600" id="totalModal">Rp 0</div>
                            <div class="text-sm text-gray-600">harga pokok penjualan</div>
                        </div>
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-bold text-blue-800 mb-2">üìà Laba Kotor</h4>
                            <div class="text-xl font-bold text-blue-600" id="grossProfit">Rp 0</div>
                            <div class="text-sm text-gray-600" id="profitMargin">0% margin</div>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h4 class="font-bold text-purple-800 mb-2">üéØ ROI</h4>
                            <div class="text-xl font-bold text-purple-600" id="roi">0%</div>
                            <div class="text-sm text-gray-600">return on investment</div>
                        </div>
                    </div>

                    <!-- Filter Periode -->
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <h3 class="text-lg font-semibold text-gray-700 mb-3">Filter Periode</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-3">
                            <button onclick="filterAnalysis('today')" id="filterToday" class="bg-green-500 text-white py-2 px-4 rounded-lg font-semibold">
                                Hari Ini
                            </button>
                            <button onclick="filterAnalysis('week')" id="filterWeek" class="bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-semibold">
                                Minggu Ini
                            </button>
                            <button onclick="filterAnalysis('month')" id="filterMonth" class="bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-semibold">
                                Bulan Ini
                            </button>
                            <button onclick="filterAnalysis('all')" id="filterAll" class="bg-gray-300 text-gray-700 py-2 px-4 rounded-lg font-semibold">
                                Semua
                            </button>
                        </div>
                    </div>

                    <!-- Product Analysis Table -->
                    <div class="overflow-x-auto">
                        <table class="w-full bg-white border border-gray-200 rounded-lg">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left font-semibold text-gray-700">Produk</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">Terjual</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">Penjualan</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">Modal</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">Laba</th>
                                    <th class="px-4 py-3 text-right font-semibold text-gray-700">Margin</th>
                                </tr>
                            </thead>
                            <tbody id="productAnalysisTable">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Cart -->
    <div id="floatingCart" class="fixed bottom-4 right-4 w-80 max-w-sm bg-white rounded-xl shadow-2xl border-2 border-green-200 z-40 transition-all duration-300 hidden">
        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-t-xl">
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-bold flex items-center">üõí Keranjang</h2>
                <div class="flex space-x-2">
                    <button onclick="clearCart()" class="bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded text-xs font-semibold">üóëÔ∏è</button>
                    <button onclick="toggleCart()" class="bg-gray-600 hover:bg-gray-700 text-white px-2 py-1 rounded text-xs font-semibold">‚ûñ</button>
                </div>
            </div>
        </div>
        
        <div id="cartContent">
            <div class="p-4 max-h-64 overflow-y-auto">
                <div id="cartItems" class="space-y-3">
                    <div class="text-center text-gray-500 py-8">
                        <p class="text-sm">Keranjang masih kosong</p>
                    </div>
                </div>
            </div>

            <div class="border-t border-gray-200 p-4 bg-gray-50 rounded-b-xl">
                <div class="space-y-3">
                    <div class="flex justify-between text-sm">
                        <span class="font-semibold">Subtotal:</span>
                        <span id="subtotal" class="font-bold">Rp 0</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span class="font-semibold">Diskon:</span>
                        <div class="flex items-center space-x-2">
                            <input type="number" id="discountInput" value="0" min="0" 
                                   class="w-16 px-2 py-1 border rounded text-right text-xs" onchange="updateTotal()">
                            <span class="text-xs">%</span>
                        </div>
                    </div>
                    <hr class="border-gray-300">
                    <div class="flex justify-between text-lg font-bold text-green-600">
                        <span>Total:</span>
                        <span id="total">Rp 0</span>
                    </div>
                    
                    <div class="mt-4">
                        <button onclick="showUnifiedPaymentModal()" 
                                class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-bold text-sm transition-colors">
                            üí≥ BAYAR
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Toggle -->
    <div id="cartToggle" class="fixed bottom-4 right-4 bg-green-500 hover:bg-green-600 text-white p-3 rounded-full shadow-lg cursor-pointer z-40 transition-all duration-300" onclick="toggleCart()">
        <div class="flex items-center space-x-2">
            <span class="text-lg">üõí</span>
            <span id="cartItemCount" class="bg-red-500 text-white text-xs rounded-full px-2 py-1 font-bold">0</span>
        </div>
    </div>

    <!-- Print Area -->
    <div id="printArea" class="print-area hidden"></div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Tambah Produk Baru</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Produk</label>
                    <input type="text" id="newProductName" class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Jual</label>
                    <input type="number" id="newProductPrice" class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none" placeholder="Masukkan 0 untuk produk jasa">
                    <div class="text-xs text-gray-500 mt-1">üí° Tip: Isi 0 untuk produk jasa (tidak perlu isi field lain)</div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Modal</label>
                    <input type="number" id="newProductModalPrice" class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Barcode</label>
                    <input type="text" id="newProductBarcode" class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Stok</label>
                        <input type="number" id="newProductStock" min="0" value="0" class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Min Stok</label>
                        <input type="number" id="newProductMinStock" min="1" value="5" class="w-full px-4 py-2 border rounded-lg focus:border-green-500 focus:outline-none">
                    </div>
                </div>
                
                <!-- Wholesale Pricing Section -->
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h4 class="text-sm font-semibold text-blue-800 mb-3 flex items-center">
                        <span class="mr-2">üè™</span>
                        Harga Grosir (Opsional)
                    </h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-gray-700 mb-1">Min Qty Grosir</label>
                            <input type="number" id="newProductWholesaleMinQty" min="2" placeholder="Contoh: 10" class="w-full px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none text-sm">
                            <div class="text-xs text-gray-500 mt-1">Minimal beli untuk harga grosir</div>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-700 mb-1">Harga Grosir</label>
                            <input type="number" id="newProductWholesalePrice" placeholder="Harga per unit" class="w-full px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none text-sm">
                            <div class="text-xs text-gray-500 mt-1">Harga per unit saat beli grosir</div>
                        </div>
                    </div>
                    <div class="text-xs text-blue-600 mt-2">
                        üí° Contoh: Min 10 pcs = Rp 8.000/pcs (dari harga normal Rp 10.000/pcs)
                    </div>
                </div>
                <div class="flex space-x-3 pt-4">
                    <button onclick="saveNewProduct()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-2 px-4 rounded-lg font-semibold">
                        Simpan
                    </button>
                    <button onclick="closeAddProductModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Product Modal -->
    <div id="editProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Edit Produk</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Produk</label>
                    <input type="text" id="editProductName" class="w-full px-4 py-2 border rounded-lg focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Jual</label>
                    <input type="number" id="editProductPrice" class="w-full px-4 py-2 border rounded-lg focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Modal</label>
                    <input type="number" id="editProductModalPrice" class="w-full px-4 py-2 border rounded-lg focus:border-blue-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Barcode</label>
                    <input type="text" id="editProductBarcode" class="w-full px-4 py-2 border rounded-lg focus:border-blue-500 focus:outline-none">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Stok</label>
                        <input type="number" id="editProductStock" min="0" class="w-full px-4 py-2 border rounded-lg focus:border-blue-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Min Stok</label>
                        <input type="number" id="editProductMinStock" min="1" class="w-full px-4 py-2 border rounded-lg focus:border-blue-500 focus:outline-none">
                    </div>
                </div>
                
                <!-- Wholesale Pricing Section -->
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h4 class="text-sm font-semibold text-blue-800 mb-3 flex items-center">
                        <span class="mr-2">üè™</span>
                        Harga Grosir (Opsional)
                    </h4>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs font-semibold text-gray-700 mb-1">Min Qty Grosir</label>
                            <input type="number" id="editProductWholesaleMinQty" min="2" placeholder="Contoh: 10" class="w-full px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none text-sm">
                            <div class="text-xs text-gray-500 mt-1">Minimal beli untuk harga grosir</div>
                        </div>
                        <div>
                            <label class="block text-xs font-semibold text-gray-700 mb-1">Harga Grosir</label>
                            <input type="number" id="editProductWholesalePrice" placeholder="Harga per unit" class="w-full px-3 py-2 border rounded-lg focus:border-blue-500 focus:outline-none text-sm">
                            <div class="text-xs text-gray-500 mt-1">Harga per unit saat beli grosir</div>
                        </div>
                    </div>
                    <div class="text-xs text-blue-600 mt-2">
                        üí° Contoh: Min 10 pcs = Rp 8.000/pcs (dari harga normal Rp 10.000/pcs)
                    </div>
                </div>
                <div class="flex space-x-3 pt-4">
                    <button onclick="saveEditedProduct()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold">
                        Update
                    </button>
                    <button onclick="deleteProduct()" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded-lg font-semibold">
                        üóëÔ∏è
                    </button>
                    <button onclick="closeEditProductModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Unified Payment Modal -->
    <div id="unifiedPaymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Pembayaran</h3>
            <div class="space-y-4">
                <div class="bg-green-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Total yang harus dibayar:</div>
                    <div class="text-2xl font-bold text-green-600" id="unifiedPaymentTotal">Rp 0</div>
                </div>
                
                <!-- Customer Name (only shown when needed) -->
                <div id="customerNameSection" class="hidden">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Pelanggan (untuk hutang)</label>
                    <input type="text" id="unifiedCustomerName" class="w-full px-4 py-2 border-2 rounded-lg focus:border-orange-500 focus:outline-none" 
                           placeholder="Nama pelanggan...">
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Jumlah Bayar</label>
                    <input type="number" id="unifiedPaymentAmount" class="w-full px-4 py-3 border-2 rounded-lg focus:border-green-500 focus:outline-none text-lg" 
                           onkeyup="calculateUnifiedPayment()" onkeypress="handleUnifiedPaymentEnter(event)">
                </div>
                
                <!-- Payment Status Display -->
                <div id="paymentStatusContainer" class="bg-gray-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600" id="paymentStatusLabel">Status pembayaran:</div>
                    <div class="text-xl font-bold text-gray-600" id="paymentStatusAmount">Masukkan jumlah bayar</div>
                    <div class="text-xs mt-1" id="paymentStatusHint"></div>
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button onclick="processUnifiedPayment()" class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-bold">
                        üí≥ Proses Bayar
                    </button>
                    <button onclick="closeUnifiedPaymentModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-semibold">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Partial Payment Modal -->
    <div id="partialPaymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4">Bayar Sebagian</h3>
            <div class="space-y-4">
                <div class="bg-orange-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Total belanja:</div>
                    <div class="text-2xl font-bold text-orange-600" id="partialTotal">Rp 0</div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Nama Pelanggan</label>
                    <input type="text" id="customerName" class="w-full px-4 py-2 border-2 rounded-lg focus:border-orange-500 focus:outline-none" 
                           placeholder="Nama pelanggan...">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Jumlah Bayar</label>
                    <input type="number" id="partialAmount" class="w-full px-4 py-3 border-2 rounded-lg focus:border-orange-500 focus:outline-none text-lg" 
                           onkeyup="calculatePartialDebt()" onkeypress="handlePartialPaymentEnter(event)">
                </div>
                <div class="bg-red-50 p-4 rounded-lg" id="debtContainer">
                    <div class="text-sm text-gray-600" id="debtLabel">Sisa hutang:</div>
                    <div class="text-xl font-bold text-red-600" id="debtAmount">Rp 0</div>
                    <div class="text-xs mt-1" id="debtStatus"></div>
                </div>
                <div class="flex space-x-3 pt-4">
                    <button onclick="processPartialPayment()" class="flex-1 bg-orange-500 hover:bg-orange-600 text-white py-3 px-4 rounded-lg font-bold">
                        üí∞ Simpan Hutang
                    </button>
                    <button onclick="closePartialPaymentModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-semibold">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Debt Payment Modal -->
    <div id="debtPaymentModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-[60] p-4" style="display: none;">
        <div class="flex items-center justify-center min-h-full">
            <div class="bg-white rounded-xl p-6 w-full max-w-md">
                <h3 class="text-xl font-bold mb-4">Bayar Hutang</h3>
                <div class="space-y-4">
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <div class="text-sm text-gray-600">Pelanggan:</div>
                        <div class="text-lg font-bold text-blue-600" id="debtCustomerName">-</div>
                        <div class="text-sm text-gray-600 mt-1">Total hutang:</div>
                        <div class="text-2xl font-bold text-red-600" id="debtTotalAmount">Rp 0</div>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Jumlah Bayar</label>
                        <input type="number" id="debtPaymentAmount" class="w-full px-4 py-3 border-2 rounded-lg focus:border-blue-500 focus:outline-none text-lg" 
                               onkeyup="calculateDebtRemaining()" onkeypress="handleDebtPaymentEnter(event)">
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg" id="debtRemainingContainer">
                        <div class="text-sm text-gray-600" id="debtRemainingLabel">Sisa hutang setelah bayar:</div>
                        <div class="text-xl font-bold text-green-600" id="debtRemainingAmount">Rp 0</div>
                        <div class="text-xs mt-1" id="debtRemainingStatus"></div>
                    </div>
                    <div class="flex space-x-3 pt-4">
                        <button onclick="processDebtPayment()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-4 rounded-lg font-bold">
                            üí∞ Bayar Hutang
                        </button>
                        <button onclick="closeDebtPaymentModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-semibold">
                            Batal
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Product Modal -->
    <div id="serviceProductModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-md">
            <h3 class="text-xl font-bold mb-4 flex items-center">
                <span class="bg-purple-100 text-purple-600 p-2 rounded-lg mr-3">üîß</span>
                Detail Produk Jasa
            </h3>
            <div class="space-y-4">
                <div class="bg-purple-50 p-4 rounded-lg">
                    <div class="text-sm text-gray-600">Produk Jasa:</div>
                    <div class="text-lg font-bold text-purple-600" id="serviceProductName">-</div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Harga Jasa</label>
                    <input type="number" id="serviceProductPrice" class="w-full px-4 py-3 border-2 rounded-lg focus:border-purple-500 focus:outline-none text-lg" 
                           placeholder="Masukkan harga jasa..." onkeypress="handleServicePriceEnter(event)">
                    <div class="text-xs text-gray-500 mt-1">üí° Masukkan harga sesuai dengan jenis layanan</div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Keterangan (Opsional)</label>
                    <textarea id="serviceProductDescription" rows="3" class="w-full px-4 py-3 border-2 rounded-lg focus:border-purple-500 focus:outline-none" 
                              placeholder="Contoh: Service AC 1 PK, Ganti oli motor, dll..."></textarea>
                    <div class="text-xs text-gray-500 mt-1">üìù Keterangan akan muncul di struk</div>
                </div>
                
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Jumlah</label>
                    <input type="number" id="serviceProductQuantity" min="1" value="1" class="w-full px-4 py-3 border-2 rounded-lg focus:border-purple-500 focus:outline-none text-lg">
                </div>
                
                <div class="flex space-x-3 pt-4">
                    <button onclick="addServiceToCart()" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white py-3 px-4 rounded-lg font-bold">
                        üõí Tambah ke Keranjang
                    </button>
                    <button onclick="closeServiceProductModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-4 rounded-lg font-semibold">
                        Batal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reports Modal -->
    <div id="reportsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-4">üìä Laporan Penjualan</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-bold text-green-800 mb-2">üìÖ Hari Ini</h4>
                    <div class="text-2xl font-bold text-green-600" id="dailyTotal">Rp 0</div>
                    <div class="text-sm text-gray-600" id="dailyTransactions">0 transaksi</div>
                </div>
                
                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-bold text-blue-800 mb-2">üìä Minggu Ini</h4>
                    <div class="text-2xl font-bold text-blue-600" id="weeklyTotal">Rp 0</div>
                    <div class="text-sm text-gray-600" id="weeklyTransactions">0 transaksi</div>
                </div>
                
                <div class="bg-purple-50 p-4 rounded-lg">
                    <h4 class="font-bold text-purple-800 mb-2">üìà Bulan Ini</h4>
                    <div class="text-2xl font-bold text-purple-600" id="monthlyTotal">Rp 0</div>
                    <div class="text-sm text-gray-600" id="monthlyTransactions">0 transaksi</div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                <div class="bg-red-50 p-4 rounded-lg">
                    <h4 class="font-bold text-red-800 mb-3">üí≥ Daftar Hutang Pelanggan</h4>
                    <div id="debtList" class="space-y-2">
                    </div>
                </div>
                
                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h4 class="font-bold text-yellow-800 mb-3">‚ö†Ô∏è Laporan Stok</h4>
                    <div id="stockReport" class="space-y-2">
                    </div>
                </div>
            </div>

            <div class="flex justify-end">
                <button onclick="closeReportsModal()" class="bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-semibold">
                    Tutup
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 hidden z-50">
        <div class="text-center">
            <div class="loader mx-auto mb-4"></div>
            <div class="text-white text-lg loading-message">Memproses...</div>
        </div>
    </div>

    <!-- Load external JavaScript after inline scripts to expose global functions -->
    <script src="script.js"></script>
</body>
</html>
